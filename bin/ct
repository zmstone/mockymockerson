#!/usr/bin/env escript

main(_Args) ->
    code:add_path("ebin"),
    CompileOptions = [debug_info, {i, "."}],
    fp("compiling with options: ~p\n", [CompileOptions]),
    case make:all([load | CompileOptions]) of
        up_to_date ->
            start_ct();
        error ->
            failed
    end.

start_ct() ->
    Files = filelib:wildcard("*_SUITE.beam", "."),
    Modules = [list_to_atom(filename:basename(FileName, ".beam"))
                || FileName <- Files],

    lists:foreach(fun(Module) -> Module:run() end, Modules),
    ok.

fp(FmtStr, Args) ->
    io:format(FmtStr, Args).

